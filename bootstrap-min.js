"use strict";(function(e){function O(){var e=Array.prototype.slice.call(arguments),t=e[0];e[0]=T(),t<=c&&console[A[t]].apply(console,e)}function M(t){t||(t=r),f=t.hook||r.hook,e[f]&&O(C,"Warning: hook '"+f+"' already exists"),e[f]=H,s=t.namespace||r.namespace,s=s?D(e,s):{},o=t.pathPrefix||r.pathPrefix,u=t.main||r.main,a=t.scriptInsertionLocation||r.scriptInsertionLocation,h=document.getElementsByTagName(a)[0],l=t.timeOut||r.timeOut,c=t.verbosity==undefined?r.verbosity:t.verbosity,c=A.indexOf(c),p=t.paths||r.paths,v=t.onExecute||r.onExecute,m=t.onLoaded||r.onLoaded,d=v?!1:!0;for(var n in p)p[n][p[n].length-1]!=="/"&&(p[n]+="/");o[o.length-1]!=="/"&&(o+="/"),g={},y={},b={},w=[],E=0,S=!1,x=[],i&&!e[f][i]?(e[f][i]=M,O(k,"Finished the bootstrap script, start loading the scripts with "+f+".init({...config...})")):(O(k,"Loading first javascript file: "+u+".js"),P(z(u),{exOrder:0,requirers:[],dependencies:[u]})),setTimeout(_,l*1e3)}function _(){var e=[];for(var t in g)g[t].status!=="loaded"&&e.push(g[t]);e.length>0&&(O(N,"Timed out:"),e.forEach(function(e){O(N,"  "+e.url)}))}function D(e,t,n){if(t){var r=t.split("/");for(var i=0;i<r.length;i++)r[i]&&(n&&i==r.length-1?e[r[i]]=n:e[r[i]]===undefined&&(e[r[i]]={}),e=e[r[i]])}return e}function P(e,t){var n=e.resource;if(n.loader&&n.loader!=="js"&&n.loader!=="bootstrap")O(k,"Making xhr request for a non bootstrap resource "+n.url),n.loader!=="css"&&(n.loader="data"),E+=1,$[n.loader].load(n.url,{toUrl:function(e){return e}},function(t){n.loader==="data"&&(n.isAbs?s[n.url]=t:D(s,n.namespace,t)),B(e)},{});else{var r=document.createElement("script");r.src=n.url,r.onloadDone=!1,r.defer=!0,r.onload=function(){r.onloadDone=!0,B(e)},E+=1,h.appendChild(r),O(k,"Inserting script tag for: "+n.url),n.blocks&&O(k,"Blocking any further script injections till this one has run")}n.status="requested"}function H(e){w.push(e)}function B(e){var t=e.resource;O(k,"Finished loading: "+t.url),t.blocks&&S&&(S=!1),E-=1,t.status="loaded",t.loader==="bootstrap"?(t.definers=w,t.definers.forEach(function(n){j(n,t,e)})):t.definers=[],w=[];while(x.length>0&&!S){var n=x.shift();n.dependency.resource.blocks&&(S=!0),P(n.dependency,n.definer)}d&&I(e),E===0&&q()}function j(e,t,n){e.resource=t,e.tag||(e.tag=""),e.load||(e.load=[]),e.inject||(e.inject=[]),e.id=t.url+"#"+e.tag;if(e.tag===n.tag)n.definer=e,e.requirers=n.requirers,console.debug(e.requirers.map(function(e){return e.id}));else{var r=n.resource.loader+"!"+n.resource.url+"#"+n.tag;b[r]||(b[r]={requirers:[],resource:n.resource,tag:e.tag}),e.requirers=b[r].requirers,b[r].definer=e}y[e.id]&&O(k,"Warning: redefining "+e.id),e.exOrder=function(){var t=e.requirers.reduce(function(e,t){return e.exOrder<t.exOrder?e:t},{exOrder:Number.MAX_VALUE});return Object.keys(y).forEach(function(e){y[e].exOrder>=t&&(y[e].exOrder+=1)}),t}(),e.dependency=n,y[e.id]=e,O(k,"New definer added to definers: "+e.id+" "+e.exOrder),F(e)}function F(e){function t(t){var n=z(t);e.dependencies.push(n),n.requirers.push(e),n.resource.status==="new"?(x.push({definer:e,dependency:n}),n.resource.status="queued"):O(k,n.resource.url+" is requested once more!!")}O(k,"Resolving deps for "+e.id),e.load.length>0&&O(k,"load "+e.load),e.inject.length>0&&O(k,"inject "+e.inject),e.dependencies=[],e.load.forEach(t),e.inject.forEach(t)}function I(e){function t(e){var t;return e.factory&&typeof e.factory=="function"?e.dependencies.map(function(e){return e.met}).reduce(function(e,t){return e&&t},!0)?(O(k,"All dependencies have been met for "+e.id+" ,executing the callback"),U(e),!0):(O(k,"There are still dependencies missing for "+e.id),!1):!0}function r(e){e.requirers.forEach(function(e){t(e)&&(e.dependency.met=!0,r(e))})}e.met=!0;if(e.resource.loader==="bootstrap"){var n=e.definer;n?n.factory&&(typeof n.factory!="function"?D(s,n.resource.namespace+def.tag,def.factory):e.met=t(n)):(O(N,(definer?"Definer "+definer.id:u)+" has asked for the dependency "+e.id+" in the resource "+e.resource.url+", which has no matching definers."),e.met=!1)}e.met&&r(e.definer)}function q(){O(k,"Finished loading, finalizing:"),Object.keys(y).forEach(function(e){e=y[e],O(k,e.resource.namespace+"#"+e.tag+" is needed in "+e.requirers.map(function(e){return e.resource.namespace+"#"+e.tag})),e.requirers.forEach(function(t){t.exOrder<e.exOrder&&O(C,"Warning! Cyclic dependency: The objects imported from "+e.id+" might be undefined in "+t.id)})}),d||v(R),m()}function R(){O(k,"Executing callbacks:");var e=[];for(var t in y)e.push(y[t]);e.sort(function(e,t){return e.exOrder>t.exOrder?1:-1}),e.forEach(function(e){typeof e.factory=="function"?U(e):D(s,e.resource.namespace+e.tag,e.factory)})}function U(e){var t=D(s,e.resource.namespace+e.tag),n=[];e.dependencies.forEach(function(e){var t=e.resource.namespace+e.tag;n.push(D(s,t))==undefined&&O(C,"Warning: "+e+" is undefined")});var r=e.factory.apply(t,n);r&&D(s,e.resource.namespace+e.tag,r)}function z(e){var t=e;e||O(C,"Empty dependency...");var n=!1,r,i,s="",u,a=!1,f,l="";e.indexOf(":")>-1&&(a=!0),e[e.length-1]==="|"&&(n=!0,e=e.substring(0,e.length-1));var c=e.lastIndexOf("#");c>-1&&(s=e.substring(c+1),e=e.substring(0,c));var h=e.lastIndexOf("."),d=e.lastIndexOf("/");h>d&&(l=e.substring(h),e=e.substring(0,h));var v=e.split("!");v.length>1&&(v[0]==="js"||v[0]==="css"||v[0]==="data")?(i=v[0],e=e.substring(e.indexOf("!")+1)):i=l,i||(a?i="data":(i="bootstrap",l=".js")),f=e;if(!a){var m=e.indexOf("/");if(m>-1){var y=p[e.substring(0,m)];y&&(e=y+e.substring(m+1))}r=o+e+l}else r=e;var w=i+"!"+r,E=w+"#"+s;return b[E]||(g[w]?(u=g[i+"!"+r],u.blocks=n):(u={id:w,url:r,namespace:f,isAbs:a,loader:i,status:"new",blocks:n},g[w]=u),b[E]={resource:u,id:t,tag:s,met:!1,requirers:[]}),b[E]}function W(e){e.call()}function X(e){O(N,e)}function V(){console.debug("definers",y,"dependencies",b,"resources",g)}var t="0.3",n="19/9/12",r={hook:"define",namespace:"module",pathPrefix:"javascript/",paths:{myapp:"path/to/package.js"},main:"myapp#foo",scriptInsertionLocation:"head",timeOut:1,verbosity:"debug",onExecute:W,onLoaded:V},i=null,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T=function(){var e=new Date;return function(){return new Date-e}}(),N=1,C=2,k=3,L=4,A=["none","error","warn","info","debug"],$={data:function(){function t(){if(typeof XMLHttpRequest!="undefined")t=function(){return new XMLHttpRequest};else{var n=t=function(){throw new Error("getXhr(): XMLHttpRequest not available")};while(e.length>0&&t===n)(function(e){try{new ActiveXObject(e),t=function(){return new ActiveXObject(e)}}catch(n){}})(e.shift())}return t()}function n(e,n,r){var i=t();i.open("GET",e,!0),i.onreadystatechange=function(e){i.readyState===4&&(i.status<400?n(i.responseText):r(new Error("fetchText() failed. status: "+i.statusText)))},i.send(null)}function r(e){throw e}var e=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"];return{load:function(e,t,i,s){var o=i.resolve||i,u=i.reject||r;n(t.toUrl(e),o,u)},"loader-builder":"./builder/text"}}(e),css:function(){function s(e,t){return e.lastIndexOf(".")<=e.lastIndexOf("/")?e+"."+t:e}function o(e,n){var r=e[t]("link");return r.rel="stylesheet",r.type="text/css",r.href=n,r}function u(e,t){return e.replace(r,t+"//")}var t="createElement",n=e.document,r=/^\/\//,i;return n&&(i=n.head||(n.head=n.getElementsByTagName("head")[0])),{load:function(e,t,r,a){var f,l,c;f=t.toUrl(s(e,"css")),c="fixSchemalessUrls"in a?a.fixSchemalessUrls:n.location.protocol,f=c?u(f,c):f,l=o(n,f),i.appendChild(l),r(l.sheet||l.styleSheet)}}}(e)};typeof bootstrap!="undefined"?M(bootstrap):M(r)})(this);