"use strict";(function(e){function k(t){t||(t=r),f=t.globalHook||r.globalHook,e[f]&&N.warn("Warning: globalHook '"+f+"' already exists"),e[f]=M,s=t.globalNamespace||r.globalNamespace,T=s?A(e,s):{},o=t.pathPrefix||r.pathPrefix,u=t.mainjs||r.mainjs,a=t.scriptInsertionLocation||r.scriptInsertionLocation,l=t.timeOut||r.timeOut,p=t.allDone||r.allDone,c=t.verbose==undefined?r.verbose:t.verbose,h=document.getElementsByTagName(a==="head"?"head":"body")[0],d=t.path_substitutions||r.path_substitutions,v=t.executeEarly||r.executeEarly,m=t.onExecute||r.onExecute;for(var n in d)d[n][d[n].length-1]!=="/"&&(d[n]+="/");o[o.length-1]!=="/"&&(o+="/"),g={},y={},b={},w=[],E=0,S=!1,x=[],N={};var _=function(){};N.error=N.warn=N.info=N.debug=function(){},N.dir=function(){console.dir.apply(console,arguments)};switch(c){case"debug":N.debug=function(){arguments[0]=C()+":"+arguments[0],console.debug.apply(console,arguments)};case"info":N.info=function(){arguments[0]=C()+":"+arguments[0],console.info.apply(console,arguments)};case"warn":N.warn=function(){console.warn.apply(console,arguments)};case"error":N.error=function(){console.error.apply(console,arguments)};case"none":break;default:N.error("Unknown verbose level")}i&&!e[f][i]?(e[f][i]=k,N.info("Finished the bootstrap script, start loading the scripts with "+f+".init({...config...})")):(N.info("Loading first javascript file: "+u+".js"),O(q(u),{exOrder:0,requirers:[],dependencies:[u]})),setTimeout(L,l*1e3)}function L(){var e=[];for(var t in g)g[t].status!=="loaded"&&e.push(g[t]);e.length>0&&(N.error("Timed out:"),e.forEach(function(e){N.error("  "+e.url)}))}function A(e,t,n){if(t){var r=t.split("/");for(var i=0;i<r.length;i++)r[i]&&(n&&i==r.length-1?e[r[i]]=n:e[r[i]]===undefined&&(e[r[i]]={}),e=e[r[i]])}return e}function O(e,t){var n=e.resource;if(n.loader&&n.loader!=="js"&&n.loader!=="bootstrap")N.info("Making xhr request for a non bootstrap resource "+n.url),n.loader!=="css"&&(n.loader="data"),E+=1,U[n.loader].load(n.url,{toUrl:function(e){return e}},function(t){n.loader==="data"&&(n.isAbs?T[n.url]=t:A(T,n.namespace,t)),_(e)},{});else{var r=document.createElement("script");r.src=n.url,r.onloadDone=!1,r.defer=!0,r.onload=function(){r.onloadDone=!0,_(e)},E+=1,h.appendChild(r),N.info("Inserting script tag for: "+n.url),n.blocks&&N.info("Blocking any further script injections till this one has run")}n.status="requested"}function M(e){w.push(e)}function _(e){var t=e.resource;N.info("Finished loading: "+t.url),t.blocks&&S&&(S=!1),E-=1,t.status="loaded",t.loader==="bootstrap"?(t.definers=w,t.definers.forEach(function(n){D(n,t,e)})):t.definers=[],w=[];while(x.length>0&&!S){var n=x.shift();n.dependency.resource.blocks&&(S=!0),O(n.dependency,n.definer)}v&&H(e),E===0&&B()}function D(e,t,n){e.resource=t,e.tag||(e.tag=""),e.load||(e.load=[]),e.inject||(e.inject=[]),e.id=t.url+"#"+e.tag;if(e.tag===n.tag)n.definer=e,e.requirers=n.requirers,console.debug(e.requirers.map(function(e){return e.id}));else{var r=n.resource.loader+"!"+n.resource.url+"#"+n.tag;b[r]||(b[r]={requirers:[],resource:n.resource,tag:e.tag}),e.requirers=b[r].requirers,b[r].definer=e}y[e.id]&&N.info("Warning: redefining "+e.id),e.exOrder=function(){var t=e.requirers.map(function(e){return e.exOrder}).reduce(function(e,t){return e<t?e:t},1e4);return Object.keys(y).forEach(function(e){y[e].exOrder>=t&&(y[e].exOrder+=1)}),t}(),e.dependency=n,y[e.id]=e,N.info("New definer added to definers: "+e.id+" "+e.exOrder),P(e)}function P(e){function t(t){var n=q(t);e.dependencies.push(n),n.requirers.push(e),n.resource.status==="new"?(x.push({definer:e,dependency:n}),n.resource.status="queued"):N.info(n.resource.url+" is requested once more!!")}N.info("Resolving deps for "+e.id),e.load.length>0&&N.info("load "+e.load),e.inject.length>0&&N.info("inject "+e.inject),e.dependencies=[],e.load.forEach(t),e.inject.forEach(t)}function H(e){function t(e){var t;return e.factory&&typeof e.factory=="function"?e.dependencies.map(function(e){return e.met}).reduce(function(e,t){return e&&t},!0)?(N.info("All dependencies have been met for "+e.id+" ,executing the callback"),I(e),!0):(N.info("There are still dependencies missing for "+e.id),!1):!0}function r(e){e.requirers.forEach(function(e){t(e)&&(e.dependency.met=!0,r(e))})}e.met=!0;if(e.resource.loader==="bootstrap"){var n=e.definer;n?n.factory&&(typeof n.factory!="function"?A(T,n.resource.namespace+def.tag,def.factory):e.met=t(n)):(N.error((definer?"Definer "+definer.id:u)+" has asked for the dependency "+e.id+" in the resource "+e.resource.url+", which has no matching definers."),e.met=!1)}e.met&&r(e.definer)}function B(){N.info("Finished loading, finalizing:"),Object.keys(y).forEach(function(e){e=y[e],N.info(e.resource.namespace+"#"+e.tag+" is needed in "+e.requirers.map(function(e){return e.resource.namespace+"#"+e.tag})),e.requirers.forEach(function(t){t.exOrder<e.exOrder&&N.warn("Warning! Cyclic dependency: The objects imported from "+e.id+" might be undefined in "+t.id)})}),v||(m(),F()),p()}function j(e){e.call()}function F(){N.info("Executing callbacks:");var e=[];for(var t in y)e.push(y[t]);e.sort(function(e,t){return e.exOrder>t.exOrder?1:-1}),e.forEach(function(e){typeof e.factory=="function"?I(e):A(T,e.resource.namespace+e.tag,e.factory)})}function I(e){var t=A(T,e.resource.namespace+e.tag),n=[];e.dependencies.forEach(function(e){var t=e.resource.namespace+e.tag;n.push(A(T,t))==undefined&&N.warn("Warning: "+e+" is undefined")});var r=e.factory.apply(t,n);r&&A(T,e.resource.namespace+e.tag,r)}function q(e){var t=e;e||N.warn("Empty dependency...");var n=!1,r,i,s="",u,a=!1,f,l="";e.indexOf(":")>-1&&(a=!0),e[e.length-1]==="|"&&(n=!0,e=e.substring(0,e.length-1));var c=e.lastIndexOf("#");c>-1&&(s=e.substring(c+1),e=e.substring(0,c));var h=e.lastIndexOf("."),p=e.lastIndexOf("/");h>p&&(l=e.substring(h),e=e.substring(0,h));var v=e.split("!");v.length>1&&(v[0]==="js"||v[0]==="css"||v[0]==="data")?(i=v[0],e=e.substring(e.indexOf("!")+1)):i=l,i||(a?i="data":(i="bootstrap",l=".js")),f=e;if(!a){var m=e.indexOf("/");if(m>-1){var y=d[e.substring(0,m)];y&&(e=y+e.substring(m+1))}r=o+e+l}else r=e;var w=i+"!"+r,E=w+"#"+s;return b[E]||(g[w]?(u=g[i+"!"+r],u.blocks=n):(u={id:w,url:r,namespace:f,isAbs:a,loader:i,status:"new",blocks:n},g[w]=u),b[E]={resource:u,id:t,tag:s,met:!1,requirers:[]}),b[E]}function R(){console.debug("definers",y,"dependencies",b,"resources",g)}var t="0.3",n="19/9/12",r={globalHook:"define",globalNamespace:"module",pathPrefix:"javascript/",path_substitutions:{myapp:"path/to/package.js"},mainjs:"myapp#foo",scriptInsertionLocation:"head",timeOut:1,onTimeOut:L,verbose:"debug",allDone:R,executeEarly:!0,onExecute:j},i=null,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C=function(){var e=new Date;return function(){if(arguments.length>0){var t=Array.prototype.slice.call(arguments);t.forEach(function(t){console.log(new Date-e+":"+t)})}return new Date-e}}(),U={data:function(){function t(){if(typeof XMLHttpRequest!="undefined")t=function(){return new XMLHttpRequest};else{var n=t=function(){throw new Error("getXhr(): XMLHttpRequest not available")};while(e.length>0&&t===n)(function(e){try{new ActiveXObject(e),t=function(){return new ActiveXObject(e)}}catch(n){}})(e.shift())}return t()}function n(e,n,r){var i=t();i.open("GET",e,!0),i.onreadystatechange=function(e){i.readyState===4&&(i.status<400?n(i.responseText):r(new Error("fetchText() failed. status: "+i.statusText)))},i.send(null)}function r(e){throw e}var e=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"];return{load:function(e,t,i,s){var o=i.resolve||i,u=i.reject||r;n(t.toUrl(e),o,u)},"loader-builder":"./builder/text"}}(e),css:function(){function s(e,t){return e.lastIndexOf(".")<=e.lastIndexOf("/")?e+"."+t:e}function o(e,n){var r=e[t]("link");return r.rel="stylesheet",r.type="text/css",r.href=n,r}function u(e,t){return e.replace(r,t+"//")}var t="createElement",n=e.document,r=/^\/\//,i;return n&&(i=n.head||(n.head=n.getElementsByTagName("head")[0])),{load:function(e,t,r,a){var f,l,c;f=t.toUrl(s(e,"css")),c="fixSchemalessUrls"in a?a.fixSchemalessUrls:n.location.protocol,f=c?u(f,c):f,l=o(n,f),i.appendChild(l),r(l.sheet||l.styleSheet)}}}(e)};typeof bootstrap!="undefined"?k(bootstrap):k(r)})(this);